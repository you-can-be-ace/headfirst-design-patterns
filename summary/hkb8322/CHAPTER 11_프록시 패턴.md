# í”„ë¡ì‹œ íŒ¨í„´
## ì •ì˜

- íŠ¹ì • ê°ì²´ë¡œì˜ ì ‘ê·¼ì„ ì œì–´í•˜ëŠ” ëŒ€ë¦¬ì¸(íŠ¹ì • ê°ì²´ë¥¼ ëŒ€ë³€í•˜ëŠ” ê°ì²´) ì œê³µ

## êµ¬ì„± ìš”ì†Œ

- `Subject` : ì£¼ì œ ì¸í„°í˜ì´ìŠ¤
- `RealSubject` : ì£¼ì œ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œ êµ¬í˜„ì²´
- `Proxy` : ì£¼ì œ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œ `RealSubject` ê°ì²´ì˜ ëŒ€ë¦¬ì¸

## ì¢…ë¥˜

- `ì›ê²© í”„ë¡ì‹œ` : ì›ê²© ê°ì²´ë¡œì˜ ì ‘ê·¼ ì œì–´ âœ…
- `ê°€ìƒ í”„ë¡ì‹œ` : ìƒì„±í•˜ê¸° í˜ë“  ìì›ìœ¼ë¡œì˜ ì ‘ê·¼ ì œì–´ âœ…
- `ë³´í˜¸ í”„ë¡ì‹œ` : ê¶Œí•œì´ í•„ìš”í•œ ìì›ìœ¼ë¡œì˜ ì ‘ê·¼ ì œì–´ âœ…
- `ë°©í™”ë²½ í”„ë¡ì‹œ` : ë„¤íŠ¸ì›Œí¬ ìì›ìœ¼ë¡œì˜ ì ‘ê·¼ ì œì–´ë¥¼ í†µí•œ ë‚˜ìœ í´ë¼ì´ì–¸íŠ¸ë¡œë¶€í„° ì£¼ì œ ë³´í˜¸
- `ìŠ¤ë§ˆíŠ¸ ë ˆí¼ëŸ°ìŠ¤ í”„ë¡ì‹œ` : ì£¼ì œê°€ ì°¸ì¡°ë  ë•Œë§ˆë‹¤ ì¶”ê°€ í–‰ë™ ì œê³µ
- `ìºì‹± í”„ë¡ì‹œ` : ë¹„ìš©ì´ ë§ì´ ë“œëŠ” ì‘ì—…ì˜ ê²°ê³¼ë¥¼ ì„ì‹œë¡œ ì €ì¥, ì—¬ëŸ¬ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ê²°ê³¼ ê³µìœ 
    - ê³„ì‚° ì‹œê°„ê³¼ ë„¤íŠ¸ì›Œí¬ ì§€ì—° ê°ì†Œ íš¨ê³¼ ë³´ìœ 
- `ë™ê¸°í™” í”„ë¡ì‹œ` : ì—¬ëŸ¬ ìŠ¤ë ˆë“œì—ì„œ ì£¼ì œì— ì ‘ê·¼í•  ë•Œ ì•ˆì „í•˜ê²Œ ì‘ì—…ì„ ì²˜ë¦¬í•  ìˆ˜ ìˆê²Œ í•´ì¤Œ
- `ë³µì¡ë„ ìˆ¨ê¹€ í”„ë¡ì‹œ` : ë³µì¡í•œ í´ë˜ìŠ¤ ì§‘í•©ìœ¼ë¡œì˜ ì ‘ê·¼ì„ ì œì–´í•˜ì—¬ ë³µì¡ë„ë¥¼ ìˆ¨ê¹€
    - í¼ì‚¬ë“œ íŒ¨í„´ì€ ëŒ€ì²´ ì¸í„°í˜ì´ìŠ¤ë§Œ ì œê³µí•˜ì§€ë§Œ ì´ í”„ë¡ì‹œëŠ” ì ‘ê·¼ ì œì–´
- `ì§€ì—° ë³µì‚¬ í”„ë¡ì‹œ` : í´ë¼ì´ì–¸íŠ¸ì—ì„œ í•„ìš”ë¡œ í•  ë•Œê¹Œì§€ ê°ì²´ê°€ ë³µì‚¬ë˜ëŠ” ê²ƒì„ ì§€ì—°ì‹œí‚´
    - ë³€í˜•ëœ ê°€ìƒ í”„ë¡ì‹œ
    - `CopyOnWriteArrayList` ì™€ ê´€ë ¨ë¨

## íŠ¹ì§•

- ì¢…ë¥˜ê°€ ë§ì§€ë§Œ í´ë¼ì´ì–¸íŠ¸ê°€ ì‹¤ì œ ê°ì²´ì˜ ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•˜ë©´ ê·¸ í˜¸ì¶œì„ ê°€ë¡œì±ˆë‹¤ëŠ” ê³µí†µì  ì¡´ì¬
- ë³´í†µ íŒ©í† ë¦¬ë¥¼ í†µí•˜ì—¬ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì§„ì§œ ê°ì²´ê°€ ì•„ë‹Œ í”„ë¡ì‹œë¥¼ ì‚¬ìš©í•˜ë„ë¡ í•¨

# í”„ë¡ì‹œ íŒ¨í„´ ğŸ†š ë°ì½”ë ˆì´í„° íŒ¨í„´ ğŸ†š ì–´ëŒ‘í„° íŒ¨í„´

ìœ ì‚¬í•´ ë³´ì´ì§€ë§Œ ìš©ë„ì— ì°¨ì´ê°€ ìˆìŒ

## í”„ë¡ì‹œ íŒ¨í„´

- ì–´ë–¤ í´ë˜ìŠ¤ë¡œì˜ ì ‘ê·¼ì„ ì œì–´í•˜ëŠ” ìš©ë„
    - í´ë¼ì´ì–¸íŠ¸ë¡œë¶€í„° ì£¼ì œ(Subject)ë¥¼ ë¶„ë¦¬
- ì£¼ì œì™€ ë™ì¼í•œ ì¸í„°í˜ì´ìŠ¤ ì‚¬ìš©

## ë°ì½”ë ˆì´í„° íŒ¨í„´

- í´ë˜ìŠ¤ì— ìƒˆë¡œìš´ í–‰ë™ì„ ì¶”ê°€í•˜ëŠ” ìš©ë„

## ì–´ëŒ‘í„° íŒ¨í„´

- ë‹¤ë¥¸ ê°ì²´ì˜ ì¸í„°í˜ì´ìŠ¤ë¥¼ ë³€ê²½
- í´ë¼ì´ì–¸íŠ¸ ì—­í• ì— ë”°ë¼ ê°ì²´ì— ìˆëŠ” íŠ¹ì • ë©”ì†Œë“œë¡œì˜ ì ‘ê·¼ì„ ì œì–´í•˜ëŠ” ë³´í˜¸ í”„ë¡ì‹œì™€ ìœ ì‚¬

# RMI (Remote Method Invocation)

- ì›ê²© JVMì— ìˆëŠ” ê°ì²´ë¥¼ ì°¾ì•„ ë©”ì†Œë“œ í˜¸ì¶œ ê°€ëŠ¥
- í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë¹„ìŠ¤ ë³´ì¡° ê°ì²´ ìƒì„±
- ë¡œì»¬ ë©”ì†Œë“œ í˜¸ì¶œê³¼ ë™ì¼í•œ ë°©ì‹ìœ¼ë¡œ ë©”ì†Œë“œ í˜¸ì¶œ ê°€ëŠ¥í•˜ì§€ë§Œ, ë„¤íŠ¸ì›Œí‚¹ ë° ì…ì¶œë ¥ ê¸°ëŠ¥ í•„ìˆ˜

## ìš©ì–´

- `ìŠ¤í…` : í´ë¼ì´ì–¸íŠ¸ ë³´ì¡° ê°ì²´ â‡’ `java.lang.reflect.Proxy` ì¸ìŠ¤í„´ìŠ¤
- `ìŠ¤ì¼ˆë ˆí†¤` : ì„œë¹„ìŠ¤ ë³´ì¡° ê°ì²´

â‡’ ì‚¬ì‹¤ìƒ RM ëŸ°íƒ€ì„ì—ì„œ ë¦¬í”Œë ‰ì…˜ì„ ì‚¬ìš©í•´ í´ë¼ì´ì–¸íŠ¸ í˜¸ì¶œì„ ì²˜ë¦¬í•˜

â‡’ ìŠ¤ì¼ˆë ˆí†¤ì€ ì‹¤ì œë¡œ ì¡´ì¬í•˜ì§€ ì•Šê³  ìŠ¤í…ì€ ë™ì  í”„ë¡ì‹œë¡œ ì²˜ë¦¬ë¨

## ì˜ˆì œ

### 1) ì›ê²© ì¸í„°í˜ì´ìŠ¤ ìƒì„±

```java
public interface MyRemote extends Remote {
    public String sayHello() throws RemoteException;
}
```

- ì›ê²© í˜¸ì¶œì„ ì§€ì›í•¨ì„ ì•Œë¦¬ê¸° ìœ„í•´ `Remote` ì¸í„°í˜ì´ìŠ¤ í™•ì¥

### 2) ì„œë¹„ìŠ¤ êµ¬í˜„ í´ë˜ìŠ¤ ìƒì„±

```java
public class MyRemoteImpl extends UnicastRemoteObject implements MyRemote {
    private static final long serialVersionUID = 1L; // ìŠˆí¼ í´ë˜ìŠ¤ê°€ Serializable êµ¬í˜„

    @Override
    public String sayHello() {
        return "Server says, 'Hey'";
    }

    public MyRemoteImpl() throws RemoteException {} // ìŠˆí¼ í´ë˜ìŠ¤ì˜ ì˜ˆì™¸ë¥¼ ì„ ì–¸í•˜ê¸° ìœ„í•¨

    public static void main(String[] args) {
        try {
            MyRemote service = new MyRemoteImpl();
            Naming.rebind("RemoteHello", service);
        } catch (Exception ex) {
            ex.printStackTrace();
        }
    }
}
```

- `UnicastRemoteObject` í™•ì¥í•˜ì—¬ ì›ê²© ê°ì²´ë¡œì„œì˜ ì—­í•  ì¶”ê°€
    - `Serializable` ì„ êµ¬í˜„í•˜ê¸° ë•Œë¬¸ì— `serialVersionUID` ê°€ í•„ìš”í•¨
- `Naming.rebind` : ë ˆì§€ìŠ¤íŠ¸ë¦¬ì— ì„œë¹„ìŠ¤ ë“±ë¡, ë“±ë¡ëœ ì´ë¦„ìœ¼ë¡œ í´ë¼ì´ì–¸íŠ¸ê°€ ê²€ìƒ‰í•¨

### 3) rmiregistry ì‹¤í–‰í•˜ê¸°

- í„°ë¯¸ë„ì„ í†µí•´ `rmiregistry` ì‹¤í–‰

### 4) ì›ê²© ì„œë¹„ìŠ¤ ì‹¤í–‰í•˜ê¸°

- ë‹¤ë¥¸ í„°ë¯¸ë„ì„ ì—´ê³  ì„œë¹„ìŠ¤ ì‹¤í–‰

# ì›ê²© í”„ë¡ì‹œ

## ì˜ˆì œ

### 1) ì¸í„°í˜ì´ìŠ¤ ìƒì„±

```jsx
public interface GumballMachineRemote **extends Remote** {
    public int getCount() throws RemoteException;
    public String getLocation() throws RemoteException;
    public State getState() throws RemoteException;
}
```

### 2) `Remote` ì¸í„°í˜ì´ìŠ¤ ë‚´ ë©”ì†Œë“œì˜ ëª¨ë“  ë¦¬í„´ íƒ€ì…ì˜ ì§ë ¬í™” ì²˜ë¦¬

```jsx
public interface State **extends Serializable** {
    public void insertQuarter();
    public void ejectQuarter();
    public void turnCrank();
    public void dispense();
}
```

```jsx
public class NoQuarterState implements State {
    **private static final long serialVersionUID = 2L;**
    transient GumballMachine gumballMachine; // ì´ í•„ë“œëŠ” ì§ë ¬í™”ì—ì„œ ì œì™¸

		// ê¸°íƒ€ ë©”ì†Œë“œ
}
```

- ì§ë ¬í™”í•˜ì—¬ ë„¤íŠ¸ì›Œí¬ë¡œ ì „ì†¡ ê°€ëŠ¥í•˜ë„ë¡ ì²˜ë¦¬

### 3) êµ¬í˜„ì²´ êµ¬í˜„

```jsx
@Getter
public class GumballMachine 
	**extends UnicastRemoteObject implements GumballMachineRemote** { // ì›ê²© ì„œë¹„ìŠ¤ ê°€ëŠ¥í•˜ë„ë¡ êµ¬í˜„
    private static final long serialVersionUID = 2L;

    State soldOutState;
    State noQuarterState;
    State hasQuarterState;
    State soldState;
    State winnerState;

    State state;
    String location;
    int count = 0;

		// ìŠˆí¼ í´ë˜ìŠ¤ì—ì„œ í•´ë‹¹ ì˜ˆì™¸ë¥¼ ë˜ì§€ê¸° ë•Œë¬¸ì— ë™ì¼í•˜ê²Œ `throws` ì²˜ë¦¬
    public GumballMachine(String location, int numberGumballs) **throws RemoteException** {
        soldOutState = new SoldOutState(this);
        noQuarterState = new NoQuarterState(this);
        hasQuarterState = new HasQuarterState(this);
        soldState = new SoldState(this);
        winnerState = new WinnerState(this);

        this.count = numberGumballs;

        if (numberGumballs > 0) {
            state = noQuarterState;
        } else {
            state = soldOutState;
        }

        this.location = location;
    }

    // ê¸°íƒ€ ë©”ì†Œë“œ
}
```

### 3) RMI ë ˆì§€ìŠ¤íŠ¸ë¦¬ì— ë“±ë¡

```jsx
public class GumballMachineTestDrive {
    public static void main(String[] args) {
        GumballMachineRemote gumballMachine = null;
        int count;

        if(args.length < 2) {
            System.out.println("GumballMachine <name> <inventory>");
            System.exit(1);
        }

        try {
            count = Integer.parseInt(args[1]);

            gumballMachine = new GumballMachine(args[0], count);
            **Naming.rebind("//" + args[0] + "/gumballmachine", gumballMachine);**
        } catch(Exception e) {
            e.printStackTrace();
        }
    }
}
```

### 4) ëª¨ë‹ˆí„°ë§ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸

```jsx
public class GumballMonitorTestDrive {
    public static void main(String[] args) {
        String[] location = {
                "rmi://santafe.mightygumball.com/gumballmachine",
                "rmi://boulder.mightygumball.com/gumballmachine",
                "rmi://austin.mightygumball.com/gumballmachine"
        };

        GumballMonitor[] monitor = new GumballMonitor[location.length];

        for (int i = 0; i < location.length; i++) {
            try {
                **GumballMachineRemote machine = (GumballMachineRemote) Naming.lookup(location[i]);**
                monitor[i] = new GumballMonitor(machine);
                System.out.println(monitor[i]);
            } catch(Exception e) {
                e.printStackTrace();
            }
        }

        for(int i = 0; i < monitor.length; i++) {
            monitor[i].report();
        }
    }
}
```

# ê°€ìƒ í”„ë¡ì‹œ

## ì˜ˆì œ

### 1) í”„ë¡ì‹œ

```jsx
public class ImageProxy implements Icon {
    volatile ImageIcon imageIcon;
    final URL imageURL;
    Thread retrievalThread;
    boolean retrieving = false;

    public ImageProxy(URL url) { imageURL = url; }

    public int getIconWidth() {
        if (imageIcon != null) {
            return imageIcon.getIconWidth();
        } else {
            return 800;
        }
    }

    public int getIconHeight() {
        if (imageIcon != null) {
            return imageIcon.getIconHeight();
        } else {
            return 600;
        }
    }

    synchronized void setImageIcon(ImageIcon imageIcon) {
        this.imageIcon = imageIcon;
    }

    public void paintIcon(final Component c, Graphics  g, int x, int y) {
        if (imageIcon != null) {
            imageIcon.paintIcon(c, g, x, y);
        } else {
            g.drawString("ì•¨ë²” ì»¤ë²„ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤ ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”.", x+300, y+190);
            if (!retrieving) {
                retrieving = true;

                retrievalThread = new Thread(new Runnable() {
                    public void run() {
                        try {
                            setImageIcon(new ImageIcon(imageURL, "Album Cover"));
                            c.repaint();
                        } catch (Exception e) {
                            e.printStackTrace();
                        }
                    }
                });
                
                retrievalThread.start();
            }
        }
    }
}
```

## ì„¤ëª…

- `ImageProxy` ëŠ” `ImageIcon` ì„ ìƒì„±í•˜ê³  ë„¤íŠ¸ì›Œí¬ URLë¡œë¶€í„° ì´ë¯¸ì§€ë¥¼ ë¶ˆëŸ¬ì˜´
- ì´ë¯¸ì§€ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë™ì•ˆ íŠ¹ì • ë¬¸êµ¬ë¥¼ í™”ë©´ì— í‘œì‹œ
- ì´ë¯¸ì§€ ë¡œë”©ì´ ëë‚˜ë©´ ëª¨ë“  ë©”ì†Œë“œ í˜¸ì¶œì„ ì´ë¯¸ì§€ ì•„ì´ì½˜ ê°ì²´ì—ê²Œ ë„˜ê¹€
- ìƒˆë¡œìš´ ì´ë¯¸ì§€ ìš”ì²­ì´ ë“¤ì–´ì˜¤ë©´ í”„ë¡ì‹œë¥¼ ìƒˆë¡œ ë§Œë“¤ê³  ìœ„ ê³¼ì • ë°˜ë³µ

# ë³´í˜¸ í”„ë¡ì‹œ

## â­ ë™ì  í”„ë¡ì‹œ
- íŠ¹ì • ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ê³  ì§€ì •í•œ í´ë˜ìŠ¤ì— ë©”ì†Œë“œ í˜¸ì¶œì„ ì „ë‹¬

## ì˜ˆì œ

### 1) `InvocationHandler` ìƒì„±

```jsx
public class OwnerInvocationHandler **implements InvocationHandler** {
    Person person;

    public OwnerInvocationHandler(Person person) {
        this.person = person;
    }

    **public Object invoke(Object proxy, Method method, Object[] args)**
            throws IllegalAccessException {

        try { // ê¶Œí•œì´ í•„ìš”í•œ ìì›ìœ¼ë¡œì˜ ì ‘ê·¼ ì œì–´
            if (method.getName().startsWith("get")) {
                return method.invoke(person, args);
            } else if (method.getName().equals("setGeekRating")) {
                throw new IllegalAccessException();
            } else if (method.getName().startsWith("set")) {
                return method.invoke(person, args);
            }
        } catch (InvocationTargetException e) {
            e.printStackTrace();
        }
        return null;
    }
}
```

### 2) ë™ì  í”„ë¡ì‹œ ìƒì„±

```jsx
public class MatchMakingTestDrive {
    HashMap<String, Person> datingDB = new HashMap<String, Person>();

    public static void main(String[] args) {
        MatchMakingTestDrive test = new MatchMakingTestDrive();
        test.drive();
    }

    public MatchMakingTestDrive() {
        initializeDatabase();
    }

    public void drive() {
        Person kim = getPersonFromDatabase("ê¹€ìë°”");
        **Person ownerProxy = getOwnerProxy(kim);**
        System.out.println("ì´ë¦„: " + ownerProxy.getName());
        ownerProxy.setInterests("ë³¼ë§, ë°”ë‘‘");
        System.out.println("ë³¸ì¸ í”„ë¡ì‹œì— ê´€ì‹¬ ì‚¬í•­ì„ ë“±ë¡í•©ë‹ˆë‹¤.");
        try {
            ownerProxy.setGeekRating(10);
        } catch (Exception e) {
            System.out.println("ë³¸ì¸ í”„ë¡ì‹œì—ëŠ” ê´´ì§œ ì§€ìˆ˜ë¥¼ ë§¤ê¸¸ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        }
        System.out.println("ê´´ì§œ ì§€ìˆ˜: " + ownerProxy.getGeekRating());

        **Person nonOwnerProxy = getNonOwnerProxy(kim);**
        System.out.println("ì´ë¦„: " + nonOwnerProxy.getName());
        try {
            nonOwnerProxy.setInterests("ë³¼ë§, ë°”ë‘‘");
        } catch (Exception e) {
            System.out.println("íƒ€ì¸ í”„ë¡ì‹œì—ëŠ” ê´€ì‹¬ ì‚¬í•­ì„ ë“±ë¡í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        }
        nonOwnerProxy.setGeekRating(3);
        System.out.println("íƒ€ì¸ í”„ë¡ì‹œì— ê´´ì§œ ì§€ìˆ˜ë¥¼ ë§¤ê¹ë‹ˆë‹¤.");
        System.out.println("ê´´ì§œ ì§€ìˆ˜: " + nonOwnerProxy.getGeekRating());
    }

    Person getOwnerProxy(Person person) {

        **return (Person) Proxy.newProxyInstance(
                person.getClass().getClassLoader(),
                person.getClass().getInterfaces(),
                new OwnerInvocationHandler(person));**
    }

    Person getNonOwnerProxy(Person person) {

        **return (Person) Proxy.newProxyInstance( // ë™ì  í”„ë¡ì‹œ ìƒì„±
                person.getClass().getClassLoader(), // í”„ë¡ì‹œ í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ í´ë˜ìŠ¤ ë¡œë”
                person.getClass().getInterfaces(),  // êµ¬í˜„ í•„ìš” ì¸í„°í˜ì´ìŠ¤
                new NonOwnerInvocationHandler(person)); // InvocationHandler ì „ë‹¬**
    }

    Person getPersonFromDatabase(String name) {
        return (Person)datingDB.get(name);
    }

    void initializeDatabase() {
        Person kim = new PersonImpl();
        kim.setName("ê¹€ìë°”");
        kim.setInterests("ìë™ì°¨, ì»´í“¨í„°, ìŒì•…");
        kim.setGeekRating(7);
        datingDB.put(kim.getName(), kim);

        Person hong = new PersonImpl();
        hong.setName("í™ê¸¸ë™");
        hong.setInterests("ìˆ˜ì§‘, ì˜í™”, ìŒì•…");
        hong.setGeekRating(6);
        datingDB.put(hong.getName(), hong);
    }
}
```

- `Proxy.newInstance`
    - `ClassLoader loader` : í”„ë¡ì‹œ í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ í´ë˜ìŠ¤ ë¡œë”
        - ì¼ë°˜ì ìœ¼ë¡œ Proxy ê°ì²´ê°€ êµ¬í˜„í•  ì¸í„°í˜ì´ìŠ¤ì˜ í´ë˜ìŠ¤ ë¡œë”ë¡œ ì „ë‹¬
    - `Class<?>[] interfaces` : í”„ë¡ì‹œ í´ë˜ìŠ¤ê°€ êµ¬í˜„í•˜ê³ ì í•˜ëŠ” ì¸í„°í˜ì´ìŠ¤ ëª©ë¡
    - `InvocationHandler h` : í”„ë¡ì‹œì˜ ë©”ì„œë“œê°€ í˜¸ì¶œë˜ì—ˆì„ ë•Œ ì‹¤í–‰ë˜ëŠ” ë©”ì„œë“œ
